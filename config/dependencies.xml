<?xml version="1.0" encoding="UTF-8"?>
<container>
    <dependency interface="dbud\model\job\environment\BuilderEnvironment" class="dbud\model\job\environment\LocalBuilderEnvironment" id="local" />

    <dependency interface="dbud\model\job\environment\BuilderEnvironment" class="dbud\model\job\environment\VirtualBoxBuilderEnvironment" id="virtualbox">
        <call method="setVirtualMachineName">
            <argument name="name" type="parameter">
                <property name="key" value="dbud.virtualbox.name" />
                <property name="default" value="dbud-worker" />
            </argument>
        </call>
        <call method="setVirtualMachineBootTime">
            <argument name="bootTime" type="parameter">
                <property name="key" value="dbud.virtualbox.boottime" />
                <property name="default" value="20" />
            </argument>
        </call>
        <call method="setVirtualMachineUsername">
            <argument name="username" type="parameter">
                <property name="key" value="dbud.virtualbox.username" />
                <property name="default" value="dbud" />
            </argument>
        </call>
        <call method="setVirtualMachinePassword">
            <argument name="password" type="parameter">
                <property name="key" value="dbud.virtualbox.password" />
                <property name="default" value="dubd" />
            </argument>
        </call>
        <call method="setCloneVirtualMachine">
            <argument name="clone" type="parameter">
                <property name="key" value="dbud.virtualbox.clone" />
                <property name="default" value="1" />
            </argument>
        </call>
    </dependency>

    <dependency class="dbud\Module" />

    <dependency interface="zibo\core\console\command\Command" class="dbud\console\RepositoryUpdateCommand" id="repository.update" />

    <dependency interface="zibo\library\queue\model\dispatcher\QueueDispatcher" class="zibo\library\queue\model\dispatcher\RoundRobinQueueDispatcher" id="dbud">
        <call method="__construct">
            <argument name="queue" type="parameter">
                <property name="key" value="dbud.queue" />
            </argument>
        </call>
        <call method="setQueueModel">
            <argument name="queueModel" type="call">
                <property name="interface" value="zibo\library\orm\OrmManager" />
                <property name="method" value="getQueueModel" />
            </argument>
        </call>
    </dependency>

    <dependency interface="dbud\model\protocol\Protocol" class="dbud\model\protocol\SftpProtocol" id="sftp">
        <call method="setZibo">
            <argument name="zibo" type="dependency">
                <property name="interface" value="zibo\core\Zibo" />
            </argument>
        </call>
        <call method="setSecurityManager">
            <argument name="securityManager" type="dependency">
                <property name="interface" value="zibo\library\security\SecurityManager" />
            </argument>
        </call>
        <call method="setSshClient">
            <argument name="sshClient" type="dependency">
                <property name="interface" value="zibo\library\ssh\SshClient" />
            </argument>
        </call>
        <call method="setPublicKeyFile">
            <argument name="publicKeyFile" type="parameter">
                <property name="key" value="dbud.ssh.key.public" />
            </argument>
        </call>
        <call method="setPrivateKeyFile">
            <argument name="privateKeyFile" type="parameter">
                <property name="key" value="dbud.ssh.key.private" />
            </argument>
        </call>
        <call method="setPrivateKeyPassphrase">
            <argument name="privateKeyPassphrase" type="parameter">
                <property name="key" value="dbud.ssh.key.passphrase" />
            </argument>
        </call>
    </dependency>

    <dependency interface="dbud\model\protocol\Protocol" class="dbud\model\protocol\FtpProtocol" id="ftp">
        <call method="setZibo">
            <argument name="zibo" type="dependency">
                <property name="interface" value="zibo\core\Zibo" />
            </argument>
        </call>
        <call method="setSecurityManager">
            <argument name="securityManager" type="dependency">
                <property name="interface" value="zibo\library\security\SecurityManager" />
            </argument>
        </call>
    </dependency>

    <dependency interface="dbud\model\protocol\Protocol" class="dbud\model\protocol\SshProtocol" id="ssh">
        <call method="setZibo">
            <argument name="zibo" type="dependency">
                <property name="interface" value="zibo\core\Zibo" />
            </argument>
        </call>
        <call method="setSecurityManager">
            <argument name="securityManager" type="dependency">
                <property name="interface" value="zibo\library\security\SecurityManager" />
            </argument>
        </call>
        <call method="setSshClient">
            <argument name="sshClient" type="dependency">
                <property name="interface" value="zibo\library\ssh\SshClient" />
            </argument>
        </call>
        <call method="setPublicKeyFile">
            <argument name="publicKeyFile" type="parameter">
                <property name="key" value="dbud.ssh.key.public" />
            </argument>
        </call>
        <call method="setPrivateKeyFile">
            <argument name="privateKeyFile" type="parameter">
                <property name="key" value="dbud.ssh.key.private" />
            </argument>
        </call>
        <call method="setPrivateKeyPassphrase">
            <argument name="privateKeyPassphrase" type="parameter">
                <property name="key" value="dbud.ssh.key.passphrase" />
            </argument>
        </call>
    </dependency>
</container>