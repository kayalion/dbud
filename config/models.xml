<?xml version="1.0" encoding="UTF-8"?>
<models>
    <model name="DbudRepository" modelClass="dbud\model\RepositoryModel" dataClass="dbud\model\data\RepositoryData" log="true">
        <field name="name" type="string">
            <validation name="required" />
        </field>
        <field name="repository" type="string">
            <validation name="required" />
        </field>
        <field name="description" type="text" />
        <field name="state" type="string" default="new" />
        <field name="builders" model="DbudServer" relation="hasMany" dependant="true" />
        <field name="servers" model="DbudServer" relation="hasMany" dependant="true" />
        <field name="slug" type="string">
            <validation name="required" />
        </field>

        <format name="title">{name}</format>
        <format name="teaser">{repository}</format>
    </model>
    
    <model name="DbudBuilder" modelClass="dbud\model\BuilderModel" dataClass="dbud\model\data\BuilderData" log="true">
        <field name="repository" model="DbudRepository" relation="belongsTo">
            <validation name="required" />
        </field>
        <field name="branch" type="string">
            <validation name="required" />
        </field>
        <field name="name" type="string">
            <validation name="required" />
        </field>
        <field name="copyRepository" type="boolean" default="1" />
        <field name="script" type="text">
            <validation name="required" />
        </field>
        <field name="dateBuilt" type="datetime" />
        <field name="revision" type="string" />
        <field name="state" type="string" default="new" />
        <field name="slug" type="string">
            <validation name="required" />
        </field>

        <format name="title">{name}</format>
        <format name="teaser">{repository.name}</format>
    </model>
    
    <model name="DbudServer" modelClass="dbud\model\ServerModel" dataClass="dbud\model\data\ServerData" log="true">
        <field name="repository" model="DbudRepository" relation="belongsTo">
            <validation name="required" />
        </field>
        <field name="branch" type="string">
            <validation name="required" />
        </field>
        <field name="name" type="string">
            <validation name="required" />
        </field>
        <field name="mode" type="string" />
        <field name="repositoryPath" type="string" default="/" />
        <field name="revision" type="string" />
        <field name="protocol" type="string">
            <validation name="required" />
        </field>
        <field name="remoteHost" type="string">
            <validation name="required" />
        </field>
        <field name="remotePort" type="string">
            <validation name="numeric" />
        </field>
        <field name="remotePath" type="string" />
        <field name="remoteUsername" type="string">
            <validation name="required" />
        </field>
        <field name="remotePassword" type="string" />
        <field name="useKey" type="boolean" />
        <field name="usePassive" type="boolean" />
        <field name="useSsl" type="boolean" />
        <field name="exclude" type="text" />
        <field name="commands" type="text" />
        <field name="state" type="string" default="new" />
        <field name="dateDeployed" type="datetime" />
        <field name="slug" type="string">
            <validation name="required" />
        </field>

        <format name="title">{name}</format>
    </model>

    <model name="DbudActivity" modelClass="dbud\model\ActivityModel" dataClass="dbud\model\data\ActivityData">
        <field name="repository" model="DbudRepository" relation="belongsTo">
            <validation name="required" />
        </field>    
        <field name="dataType" type="string" />
        <field name="dataId" type="string" />
        <field name="description" type="text">
            <validation name="required" />
        </field>    
        <field name="job" model="Queue" relation="belongsTo" dependant="true" />
        <field name="state" type="string">
            <validation name="required" />
        </field>
        <field name="dateAdded" type="datetime" />
    </model>
</models>